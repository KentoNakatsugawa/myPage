# NOREL WITH LINE Mini App 開発に関する確認事項

**作成日**: 2024年12月22日
**プロジェクト**: NOREL WITH（LINEミニアプリ マイページ機能）
**目的**: 既存LINE公式アカウントと連携したLINEミニアプリ開発にあたり、MicoCloud側での設定・連携要件を確認

---

## 1. プロジェクト概要

### 開発予定のアプリケーション
NOREL WITH は、NOREL（カーサブスクリプションサービス）の契約者向けマイページ機能を提供するLINEミニアプリです。

### 主な機能
- 契約進捗の可視化（8ステップのミッション形式）
- 支払いスケジュール確認
- 契約書類の閲覧・ダウンロード
- AIコンシェルジュ（FAQ対応）
- 車両レコメンド
- NORELスコア表示

### 技術スタック
- フロントエンド: Next.js 14 / TypeScript / Tailwind CSS
- ホスティング: Vercel
- 認証: LIFF SDK（LINE Front-end Framework）

---

## 2. 確認事項

### 2.1 LINE Developers プロバイダー・チャネル関連

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 1 | 現在のLINE Developersプロバイダーの管理者権限を開発チームに付与可能か？ | |
| 2 | 既存プロバイダー内に新規LIFFアプリ（チャネル）を追加作成可能か？ | |
| 3 | 既存のMessaging APIチャネルID / Channel Secretの共有は可能か？ | |
| 4 | LINE公式アカウントのベーシックID / プレミアムIDは？ | |

### 2.2 LIFF アプリ設定

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 5 | LIFF IDの新規発行はMicoCloud側で実施いただけるか？または開発チーム側で実施可能か？ | |
| 6 | LIFFエンドポイントURL（本番/ステージング）の登録手順は？ | |
| 7 | LIFFのScope設定（profile, openid, chat_message.write等）の推奨は？ | |
| 8 | Bot Link機能（友だち追加オプション）の設定は？ | |

### 2.3 MicoCloud API連携

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 9 | MicoCloudのAPI連携仕様書（エンドポイント、認証方式）は提供可能か？ | |
| 10 | NOREL WITHからMicoCloudへのデータ連携方式は？（API / Webhook / CSV） | |
| 11 | MicoCloudからNOREL WITHへのWebhook通知は設定可能か？ | |
| 12 | API利用に追加費用は発生するか？ | |

### 2.4 顧客データ連携

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 13 | MicoCloud上の顧客識別子（顧客ID）の形式は？ | |
| 14 | LINE UID（ユーザーID）の取得・参照は可能か？ | |
| 15 | 顧客属性データ（タグ、セグメント）のAPI取得は可能か？ | |
| 16 | 友だち追加経路の識別（QRコード別等）データは取得可能か？ | |

### 2.5 メッセージ配信連携

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 17 | NOREL WITHからのイベント（ステップ完了等）をトリガーにMicoCloudから通知配信は可能か？ | |
| 18 | シナリオ配信でNOREL WITH内のデータ（契約ステップ等）を条件に使用可能か？ | |
| 19 | Service Message（無料通知）の利用は可能か？ | |
| 20 | リッチメニューの動的切り替え（契約ステップ別等）は設定可能か？ | |

### 2.6 会員証機能（Micomii）

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 21 | 現在Micomii（会員証機能）は利用中か？ | |
| 22 | NOREL WITHと会員証機能を統合する場合の技術要件は？ | |
| 23 | 会員証とNOREL WITHを別々に運用する場合、リッチメニューからの導線設計の推奨は？ | |

### 2.7 開発・テスト環境

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 24 | 開発・テスト用のサンドボックス環境は用意可能か？ | |
| 25 | テスト用LINEアカウント（友だち登録済み）の用意は可能か？ | |
| 26 | ステージング環境でのLIFFテストの推奨手順は？ | |

### 2.8 運用・サポート

| # | 確認事項 | 回答欄 |
|---|----------|--------|
| 27 | NOREL WITHリリース後の技術サポート体制は？ | |
| 28 | MicoCloud側で障害発生時の通知・連絡フローは？ | |
| 29 | APIレート制限や利用上限はあるか？ | |

---

## 3. 想定する連携アーキテクチャ

```
┌─────────────────────────────────────────────────────────────────────┐
│                         ユーザー (LINEアプリ)                         │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      LINE プラットフォーム                            │
│  ┌──────────────────┐    ┌──────────────────┐                       │
│  │  Messaging API   │    │   LIFF (Mini App) │                      │
│  └──────────────────┘    └──────────────────┘                       │
└─────────────────────────────────────────────────────────────────────┘
          │                           │
          ▼                           ▼
┌──────────────────────┐    ┌──────────────────────────────────────────┐
│     MicoCloud        │◄───│           NOREL WITH                      │
│  (Mico Engage AI)    │    │  ┌─────────────────────────────────────┐ │
│                      │───►│  │  フロントエンド (Vercel)              │ │
│  • 顧客管理          │    │  │  • マイページUI                      │ │
│  • セグメント配信    │    │  │  • 契約進捗表示                      │ │
│  • シナリオ配信      │    │  │  • AIコンシェルジュ                  │ │
│  • 分析              │    │  └─────────────────────────────────────┘ │
│                      │    │                    │                     │
└──────────────────────┘    │                    ▼                     │
                            │  ┌─────────────────────────────────────┐ │
                            │  │  バックエンドAPI                     │ │
                            │  │  • LIFF認証検証                      │ │
                            │  │  • 契約データ取得                    │ │
                            │  └─────────────────────────────────────┘ │
                            └──────────────────────────────────────────┘
                                                 │
                                                 ▼
                            ┌──────────────────────────────────────────┐
                            │         既存NORELシステム                 │
                            │  • 契約管理  • 顧客マスタ  • 車両在庫    │
                            └──────────────────────────────────────────┘
```

---

## 4. 連携データフロー（案）

### 4.1 ユーザー認証フロー
```
1. ユーザーがリッチメニューから「マイページ」をタップ
2. LIFF起動 → liff.init() → liff.login()
3. LINE UIDおよびアクセストークン取得
4. NOREL WITHバックエンドでトークン検証
5. LINE UID → NOREL顧客ID 紐付け確認
6. マイページ表示
```

### 4.2 MicoCloud → NOREL WITH（顧客データ参照）
```
• 目的: MicoCloud上の顧客セグメント・タグ情報をNOREL WITHで活用
• 方式: API（GET）or Webhook
• データ: 顧客ID, タグ一覧, 友だち追加日時, 流入経路
```

### 4.3 NOREL WITH → MicoCloud（イベント通知）
```
• 目的: 契約ステップ完了等のイベントをMicoCloudに通知し、シナリオ配信のトリガーに活用
• 方式: API（POST）or Webhook
• データ: 顧客ID, イベント種別, タイムスタンプ
• イベント例:
  - step_completed (ステップ1〜8完了)
  - document_viewed (書類閲覧)
  - payment_confirmed (支払い確認)
  - vehicle_delivered (納車完了)
```

---

## 5. スケジュール（案）

| フェーズ | 内容 | 期間 |
|----------|------|------|
| Phase 0 | 本確認事項の回答・調整 | - |
| Phase 1 | LIFF設定・開発環境構築 | - |
| Phase 2 | API連携実装・テスト | - |
| Phase 3 | ステージング検証 | - |
| Phase 4 | 本番リリース | - |

※ 具体的なスケジュールは要件確定後に調整

---

## 6. 補足資料（必要に応じて提供依頼）

- [ ] MicoCloud API仕様書
- [ ] Webhook設定ガイド
- [ ] LINE Developersコンソール招待（プロバイダー管理者権限）
- [ ] 既存リッチメニュー設定情報
- [ ] 顧客データエクスポートサンプル（個人情報マスク済み）

---

## 7. お問い合わせ先

| 項目 | 内容 |
|------|------|
| プロジェクト担当 | （記入欄） |
| 技術担当 | （記入欄） |
| メールアドレス | （記入欄） |
| 電話番号 | （記入欄） |

---

**本ドキュメントに関するご質問・ご不明点がございましたら、お気軽にお問い合わせください。**
